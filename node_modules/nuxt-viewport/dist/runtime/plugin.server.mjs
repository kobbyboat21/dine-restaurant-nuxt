import { createViewportManager, STATE_KEY } from "./manager.mjs";
import { detectBreakpoint, parseCookie } from "./utils.mjs";
import { defineNuxtPlugin, useState } from "#imports";
import viewportOptions from "#viewport-options";
export default defineNuxtPlugin(async (nuxtApp) => {
  const state = useState(STATE_KEY);
  const manager = createViewportManager(viewportOptions, state);
  let cookie = "";
  let userAgent = "";
  const headers = nuxtApp?.ssrContext?.event?.req?.headers;
  if (headers != null) {
    cookie = headers.cookie;
    userAgent = headers["user-agent"];
  }
  if (typeof cookie !== "string") {
    cookie = "";
  }
  cookie = parseCookie(cookie)[viewportOptions.cookieName];
  state.value = await detectBreakpoint.call(viewportOptions, cookie, userAgent);
  return nuxtApp.provide("viewport", manager);
});
